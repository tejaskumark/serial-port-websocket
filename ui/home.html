<html>

<head>
    <meta name="author" content="Tejaskumar Kasundra">
    <nav class="navbar navbar-expand-md navbar-dark bg-dark mb-4">
        <a class="navbar-brand" href="#">Serial Console Server</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
            aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active type">
                    <a class="nav-link" value="ports" href="#">PORTS<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item type">
                    <a class="nav-link disabled" value="help" href="#">FAQ</a>
                </li>
            </ul>
        </div>
    </nav>

    </div>
</head>

<style>
    .th {
        width: auto;
        text-align: center;
        vertical-align: middle;
    }

    hr.new4 {
        border: 3px solid black;
    }

    .cellContainer {
        width: 25%;
        float: left;
        margin-top: 1.5em;
    }

    .lb-md {
        font-size: 20px;
        text-align: center;
        font-weight: bold;
    }

    .table>tbody>tr>td {
        width: auto;
        vertical-align: middle;
        text-align: center;
    }
</style>
<link rel="stylesheet" type="text/css" href="ui/bootstrap-4.1.3-dist/Datatables/datatables.css" />
<link href="ui/bootstrap-4.1.3-dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="ui/bootstrap-4.1.3-dist/js/jquery-3.4.1.min.js"></script>
<script src="ui/bootstrap-4.1.3-dist/js/popper.min.js"></script>
<script src="ui/bootstrap-4.1.3-dist/js/bootstrap.min.js"></script>
<script src="ui/bootstrap-4.1.3-dist/js/bootbox.js"></script>
<script src="ui/bootstrap-4.1.3-dist/Datatables/datatables.js"></script>
<script>
    // Boxalert for given user msg string.
    function boxalert(msg) {
        bootbox.alert({
            message: msg,
            callback: function (result) {
            }
        });
    };

    // Catch click on ports and FAQ tab.
    $(function () {
        if ($(".nav-item").click(function () {
            var selection = $(this).children(".nav-link").attr("value");
            $(".type").removeClass("active");
            $(this).addClass("active");
            if (selection == "ports") {
                $("#help").hide();
                $("#ports").show();
                TableCreation();
            };
            if (selection == "help") {
                document.getElementById("response").innerHTML = "";
                $("#portstag").hide();
                $("#help").show();
            };
        }));
    });
    // Call API and get response and populate table.
    function TableCreation() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                CreateTableFromJSON(this.responseText);
                $("#portstag").show();
            }
            if (this.readyState == 4 && this.status != 200) {
                boxalert("Ports details get API failing.");
            }
        };
        xhttp.open("GET", "/get/config", true);
        xhttp.send();
    }
    // On page load run function
    $(document).ready(function () {
        TableCreation()
    });

    // Create button based on input
    function CreateBtn(cls, id, text, link) {
        var btn = document.createElement("button");
        btn.type = "button";
        btn.className = cls;
        btn.id = id
        // btn.setAttribute("style", "width:100px")
        if (link != null) {
            btn.setAttribute("onclick", link);
        }
        btn.setAttribute("target", "_blank")
        btn.innerHTML = text;
        return btn;
    }

    // Create Table from JSON response
    function CreateTableFromJSON(JSONResponse) {
        document.getElementById("response").innerHTML = "";
        // BUILD Paths
        var col = ["Device Name", "Port", "Baudrate", "Action"];

        // CREATE DYNAMIC TABLE.
        var table = document.createElement("table");
        table.className += "table";
        table.id = "dataTable";
        var header = table.createTHead();
        header.className += "thead-dark";

        // CREATE HTML TABLE HEADER ROW USING THE EXTRACTED HEADERS ABOVE.
        var tr = header.insertRow(-1);
        for (var i = 0; i < col.length; i++) {
            var th = document.createElement("th");
            th.className += "th";
            th.innerHTML = col[i];
            tr.appendChild(th);
        }

        // Populate table from JSON Data. 
        var col = [];
        JSONConvert = JSON.parse(JSONResponse);
        var tb = table.createTBody();
        tb.id += "myTable"
        for (var i = 0; i < JSONConvert.Ports.length; i++) {
            var row = tb.insertRow(-1);
            var cell0 = row.insertCell(0);
            var cell1 = row.insertCell(1);
            var cell2 = row.insertCell(2);
            var cell3 = row.insertCell(3);
            cell0.innerHTML = JSONConvert.Ports[i].Desc;
            cell1.innerHTML = JSONConvert.Ports[i].Name;
            cell2.innerHTML = JSONConvert.Ports[i].Baudrate;
            var link = "window.open('" + window.location.protocol + "//" + window.location.hostname + ":" + window.location.port +
                "/port?portname=" + JSONConvert.Ports[i].Name + "')"
            var getconsole = CreateBtn("btn btn-info mr-2", JSONConvert.Ports[i].Name,
                "Get Console", link)
            link = "window.open('" + window.location.protocol + "//" + window.location.hostname + ":" + window.location.port +
                "/logs/')"
            var getlogs = CreateBtn("btn btn-info", "",
                "Get Logs", link)
            cell3.append(getconsole, getlogs);
        }

        // FINALLY ADD THE NEWLY CREATED TABLE WITH JSON DATA TO A CONTAINER.
        var divContainer = document.getElementById("response");
        divContainer.appendChild(table);
        $('#dataTable').DataTable();
    };

</script>

<body>
    <div class="container-fluid">
        <div id="portstag" style="display: none;">
            <div id="response"></div>
        </div>
        <div id="help" style="display: none;"></div>

    </div>
</body>